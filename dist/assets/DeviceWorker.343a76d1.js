(function(){"use strict";const M=e=>({value:e,chain:t=>{console.time("--> DW: "+t.name);let r=t(e);return console.timeEnd("--> DW: "+t.name),M(r)},output:(t,r)=>{e?t(e):r()}});function y(e,t){switch(t){case e:return"forward";case[...e].reverse().join(""):return"reverse";default:return"anagram"}}function R(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];t.length===0?t=n:(t=t.map(o=>n.map(u=>[o,u].flat())),t=[].concat(...t))}return t}function S(e){return e.sort((t,r)=>t.length-r.length)}let N=new Map,g=new Map,m=[],T=5,C;const b={initialise:e=>(N=e,E(),!0),updateWordFilters:({length:e=15,score:t=45,maxWords:r=4})=>(T=r||T||4,!0),getDevices:e=>(C=e,console.log("--> DW: Start:"+e),M(e).chain(G).chain(H).chain(S).chain(P).value)};self.onmessage=function(t){var i;const{id:r,request:n,payload:o}=t.data,u=f=>postMessage({id:r,request:n,response:f}),l=()=>postMessage({id:r,request:n,error:`Fail: ID-${r} `});M(o).chain((i=b==null?void 0:b[n])!=null?i:f=>f).output(u,l)};const I={E:2,A:3,R:5,I:7,O:11,T:13,N:17,S:19,L:23,C:29,U:31,D:37,P:41,M:43,H:47,G:53,B:59,F:61,Y:67,W:71,K:73,V:79,X:83,Z:89,J:97,Q:101},k=new Map(Object.entries(I));function L(e){let t=1;for(let r of e)t*=I[r];return t}function E(){g=new Map,m=[];let e=new Map;for(let[t,r]of N)if(t.length<15&&r.score>46){let n=L(t),o=e.get(n);o?e.set(n,o.add(t)):e.set(n,new Set([t]))}for(let t of e)g.set(Number(t[0]),[...t[1]]),m.push(Number(t[0]));m.sort((t,r)=>r-t)}const O=e=>(g==null?void 0:g.get(e))||F(e),F=e=>{let t="";for(let[r,n]of k)for(;e%n==0;)t+=r,e/=n;return[t]},d=e=>({word:e,...N.get(e)});function G(e,t=T){let r=typeof e=="number"?e:L(e),n=[];for(let l=0;l<m.length;l++)r%m[l]==0&&n.push(m[l]);let o=n.length;return u(r);function u(l,i=0,f=0){if(f>t)return[];let s=[],a=(O(l)[0].length>>1)-1;for(let h=i;h<o;h++){let p=n[h];if(!(g.get(p)[0].length<a)&&l%p==0){let D=l/p,j=n.findIndex(v=>v<=D);if(n[j]==D){let v=[Number(p),Number(D)];s.push(v)}else if(j==-1)continue;let W=u(D,j,f+1);for(let v of W)s.push([Number(p),...v.map(_=>Number(_))])}}return s}}function H(e){let t=[];for(let r of e){let n=r.map(u=>O(u)),o=R(n);t.push(...o)}return t}function A(e,t,r=0){let n=t.slice();if(n.length==1&&n[0].length==e.length)return[{...d(n[0]),direction:y(n[0],e)}];for(let l=0;l<n.length;l++){let i=n[l],f=o(n[l],e);if(f=="start"){let s,c="";[s,c]=[e.slice(0,i.length),e.slice(i.length)],n.splice(l,1),l=-1;let a=A(c,n,r);if(a)return[{...d(i),direction:y(i,s)},...a]}else if(f=="end"){let s=n[l],c=e.slice(-1*s.length),a=e.slice(0,e.length-s.length);n.splice(l,1);let h=A(a,n,r);if(h!=null)return[...h,{...d(s),direction:y(s,c)}]}else if(r==0){let s=u(i,e);if(s!=null){let c,a="";[c,a]=s,n.splice(l,1);let h=A(a,n,1);if(h!=null)return[{...d(i),direction:y(i,c),contains:h}]}}}return null;function o(l,i){switch([...l].sort().join("")){case[...i.substring(0,l.length)].sort().join(""):return"start";case[...i.substring(i.length-l.length)].sort().join(""):return"end";default:return null}}function u(l,i){if(l.length<2)return null;let f=[...l].sort().join(""),s=i.length-l.length;if(s==0)return null;for(let c=1;c+s<i.length;c++){let a=i.slice(0,c)+i.slice(c+s);if([...a].sort().join("")==f)return[a,i.slice(c,c+s)]}return null}}function P(e){let t=[],r=[];for(let n of e.slice(0,1e3)){let o=A(C,n);if(o)t.push({words:o});else{let u=n.map(d);r.push({words:u})}}return{anagrams:r,containers:t}}})();
