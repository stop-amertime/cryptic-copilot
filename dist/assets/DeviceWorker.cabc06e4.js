(function(){"use strict";const A=e=>({value:e,chain:t=>{e||console.warn("FAILED TO: ",t.name),console.time(t.name);let n=t(e);return console.timeEnd(t.name),A(n)},output:(t,n)=>{e?t(e):n()}});function v(e,t){switch(t){case e:return"forward";case[...e].reverse().join(""):return"reverse";default:return"anagram"}}function j(e,t){if(e===t)return!0;if(e==null||t==null||e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}function C(e){let t=[];for(let n=0;n<e.length;n++){let r=e[n];t.length===0?t=r:(t=t.map(c=>r.map(u=>[c,u].flat())),t=[].concat(...t))}return t}function R(e){return e.sort((t,n)=>t.length-n.length)}let D=new Map,m=new Map,g=[],M,I;const T={initialise:e=>(D=e,L(),!0),updateWordFilters:({length:e=15,score:t=45,maxWords:n=4})=>(M=n||M||4,!0),getDevices:e=>(I=e,A(e).chain(F).chain(H).chain(R).chain(w).value)};self.onmessage=function(t){var i;const{id:n,request:r,payload:c}=t.data,u=f=>postMessage({id:n,request:r,response:f}),l=()=>postMessage({id:n,request:r,error:`Fail: ID-${n} `});A(c).chain((i=T==null?void 0:T[r])!=null?i:f=>f).output(u,l)};const O={E:2,A:3,R:5,I:7,O:11,T:13,N:17,S:19,L:23,C:29,U:31,D:37,P:41,M:43,H:47,G:53,B:59,F:61,Y:67,W:71,K:73,V:79,X:83,Z:89,J:97,Q:101},E=new Map(Object.entries(O));function b(e){let t=1;for(let n of e)t*=O[n];return t}function L(){m=new Map,g=[];let e=new Map;for(let[t,n]of D)if(t.length<15&&n.score>46){let r=e.get(n.hash);r?e.set(n.hash,r.add(t)):e.set(n.hash,new Set([t]))}for(let t of e)m.set(Number(t[0]),[...t[1]]),g.push(Number(t[0]));g.sort((t,n)=>n-t)}const S=e=>(m==null?void 0:m.get(e))||k(e),k=e=>{let t="";for(let[n,r]of E)for(;e%r==0;)t+=n,e/=r;return[t+"!!!"]},d=e=>({word:e,...D.get(e)});function F(e,t=M){let n=typeof e=="number"?e:b(e),r=[];for(let l=0;l<g.length;l++)n%g[l]==0&&r.push(g[l]);let c=r.length;return u(n);function u(l,i=0,f=0){if(f>t)return[];let s=[];for(let o=i;o<c;o++){let a=r[o];if(l%a==0){let h=l/a,N=r.findIndex(p=>p<=h);if(r[N]==h){let p=[Number(a),Number(h)];s.push(p)}else if(N==-1)continue;let G=u(h,N,f+1);for(let p of G)s.push([Number(a),...p.map(P=>Number(P))])}}return s}}function H(e){let t=[];for(let n of e){let r=n.map(u=>S(u)),c=C(r);for(let u=0;u<c.length;u++)t.some(l=>j(l,c[u]))||t.push(c[u])}return t}function y(e,t,n=0){let r=t.slice();if(r.length==1&&r[0].length==e.length)return[{...d(r[0]),direction:v(r[0],e)}];for(let l=0;l<r.length;l++){let i=r[l],f=c(r[l],e);if(f=="start"){let s,o="";[s,o]=[e.slice(0,i.length),e.slice(i.length)],r.splice(l,1),l=-1;let a=y(o,r,n);if(a)return[{...d(i),direction:v(i,s)},...a]}else if(f=="end"){let s=r[l],o=e.slice(-1*s.length),a=e.slice(0,e.length-s.length);r.splice(l,1);let h=y(a,r,n);if(h!=null)return[...h,{...d(s),direction:v(s,o)}]}else if(n==0){let s=u(i,e);if(s!=null){let o,a="";[o,a]=s,r.splice(l,1);let h=y(a,r,1);if(h!=null)return[{...d(i),direction:v(i,o),contains:h}]}}}return null;function c(l,i){switch([...l].sort().join("")){case[...i.substring(0,l.length)].sort().join(""):return"start";case[...i.substring(i.length-l.length)].sort().join(""):return"end";default:return null}}function u(l,i){if(l.length<2)return null;let f=[...l].sort().join(""),s=i.length-l.length;if(s==0)return null;for(let o=1;o+s<i.length;o++){let a=i.slice(0,o)+i.slice(o+s);if([...a].sort().join("")==f)return[a,i.slice(o,o+s)]}return null}}function w(e){let t=[],n=[];for(let r of e){let c=y(I,r);if(c)t.push({words:c});else{let u=r.map(d);n.push({words:u})}}return{anagrams:n,containers:t}}})();
