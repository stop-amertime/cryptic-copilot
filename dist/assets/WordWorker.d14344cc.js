(function(){"use strict";const x=["ER","ED","S","ING","ABLE"],S=e=>e.reduce((t,n)=>{var s;return t+((s=h==null?void 0:h.get(n.word))==null?void 0:s.score)||0},0)/e.length;let h=new Map;self.onmessage=function(t){var i;const{id:n,request:s,payload:l}=t.data,a=u=>postMessage({id:n,request:s,response:u}),r=u=>postMessage({id:n,request:s,error:u});if(!!t.data.payload)switch((i=t.data)==null?void 0:i.request){case"setDictionary":{h=l,console.time("Sorting Workers Dictionary"),h=new Map(Array.from(h).sort(u=>{var o;return((o=u[1])==null?void 0:o.score)||0})),console.timeEnd("Sorting Workers Dictionary"),a("Done.");break}case"getPossibleWords":{a(O.search(l));break}case"getDevices":{let u=C.fetchAndParseThesaurus(l),o=k(l);u.then(c=>a({thesaurus:c,...o}));break}default:{r("Invalid Request Type: "+s);return}}};const L={E:2,A:3,R:5,I:7,O:11,T:13,N:17,S:19,L:23,C:29,U:31,D:37,P:41,M:43,H:47,G:53,B:59,F:61,Y:67,W:71,K:73,V:79,X:83,Z:89,J:97,Q:101},_=e=>{var t;return((t=h.get(e))==null?void 0:t.hash)||P(e)};function P(e){let t=1;for(let n of e)t*=L[n];return t}function $(e,t){let n=Array.from(t);return typeof e=="string"&&(e=Array.from(e)),n=n.splice(0),e.filter((s,l,a)=>{let r=n.indexOf(s);return r>-1?(n.splice(r,1),!1):!n.includes(s)})}function p(e,t){switch(t){case e:return"forward";case[...e].reverse().join(""):return"reverse";default:return"anagram"}}function q(e){return e.toUpperCase().replace(/[^A-Z]/,"")}const C={get(e){return k(e)},async fetchAndParseThesaurus(e){var r;const n=await(await fetch("https://dictionaryapi.com/api/v3/references/thesaurus/json/"+e+"?key=f6bff6bb-3ff1-42d4-9de7-86291d3e2b26")).json();let s=[],l=0;for(let i of n){if(i.meta==null){s=[];break}if(q(i.meta.id)!=e)break;let o=[];for(let c of i.def[0].sseq){let f=c[0][1],g=[],D=0;if(f.syn_list)for(let v of f.syn_list[0]){let d=[];if(f.rel_list&&f.rel_list[D]){for(let w of f.rel_list[D])w.wd&&d.push(w.wd);g.push({mainWord:v.wd,relatedWords:d}),D++}}else if(f.sim_list)for(let v of f.sim_list)g.push({mainWord:v[0].wd,relatedWords:v.filter((d,w)=>w!=0).map(d=>d.wd)});else continue;o.push({definition:f.dt[0][1],synonyms:g}),l++}s.push({partOfSpeech:i.fl,senses:o})}let a=((r=h==null?void 0:h.get(e))==null?void 0:r.abbreviationFor)||null;return a&&(l+=(a==null?void 0:a.length)||0),{partsOfSpeech:s,numberOfSenses:l,abbreviationFor:a}}};function k(e){console.time("Crawl Anagram Tree");let t=j(e,h);console.timeEnd("Crawl Anagram Tree"),console.table(t.filter(s=>s.join("").length!=e.length));let n=F(t,e);return G(n),n}function j(e,t=h){let n=_(e),s=[],l=[];for(let[r,i]of t)i.hash==n?s.push([r]):n%i.hash==0&&l.push([r,{hash:i.hash}]);let a=e.length>>1;for(let r=0;r<l.length;r++){let i=l[r][0],u=new Map(l.slice(r));if(i.length<a)continue;let o=$(e,i).join(""),c=j(o,u);if(c!=null)for(let f of c){let g=[i,f].flat(1);s.push(g)}}return s.length==0?null:s}function m(e,t,n=0){let s=e;if(t.length==1&&t[0].length==s.length)return[{word:t[0],direction:p(t[0],s)}];for(let r=0;r<t.length;r++){let i=t[r],u=l(t[r],s);if(u=="start"){let o,c="";[o,c]=[s.slice(0,i.length),s.slice(i.length)],t.splice(r,1),r=-1;let f=m(c,t,n);if(f!=null)return[{word:i,direction:p(i,o)},...f]}else if(u=="end"){let o=t[r],c=s.slice(-1*o.length),f=s.slice(0,s.length-o.length);t.splice(r,1);let g=m(f,t,n);if(g!=null)return[...g,{word:o,direction:p(o,c)}]}else if(n==0){let o=a(i,s);if(o!=null){let c,f="";[c,f]=o,t.splice(r,1);let g=m(f,t,1);if(g!=null)return[{word:i,direction:p(i,c),contains:g}]}}}return null;function l(r,i){switch([...r].sort().join("")){case[...i.substring(0,r.length)].sort().join(""):return"start";case[...i.substring(i.length-r.length)].sort().join(""):return"end";default:return null}}function a(r,i){if(r.length<2)return null;let u=[...r].sort().join(""),o=i.length-r.length;if(o==0)return null;for(let c=1;c+o<i.length;c++){let f=i.slice(0,c)+i.slice(c+o);if([...f].sort().join("")==u)return[f,i.slice(c,c+o)]}return null}}function M(e){let t=0,n=0;for(let l=0;l<e.length;l++)e[l].contains!=null&&(e.concat(e[l].contains),t+=1),(e[l].direction=="reverse"||e[l].direction=="anagram")&&(t+=1),e[l].score=h.get(e[l].word).score,n+=e[l].score,n+=e[l].word.length*2;return~~(n/e.length)-5*e.length-3*t}function F(e,t){let n=[],s=[];for(let l of e){if(l.join("").length!=t.length)continue;let a=m(t,l);if(a)x.includes(a[a.length-1].word)||n.push({words:a});else{let r=l.map(i=>({word:i}));s.push({words:r})}}return{anagrams:s,containers:n}}function G(e){e.anagrams&&e.anagrams.sort((t,n)=>t.words.length-n.words.length||S(t.words)-S(n.words)),e.containers&&e.containers.sort(function(t,n){return M(n.words)-M(t.words)})}const O={search(e){let t=E(e),n=e.length,s=[];for(let l of h.keys())l.length==n&&t.test(l)&&s.push(l);return s},checkValidNewWord(e,t){let n=e.length,s=t.length,l,a,r;return E(t).test(e)?(l=!0,[a,r]=[`'${e}' can be entered as a custom word.`,"#44D62C"]):(l=!1,[a,r]=e.length!=s?[`${n} / ${s} letters needed to be a custom word.`,"#FA4616"]:[`'${e}' doesn't fit with the letters on the grid.`,"#E40046"]),[l,a,r]},anyPossibleWord(e){let t=this.generateMatchRegex(e),n=e.length;for(let s of h.keys())if(s.length==n&&t.test(s))return!0;return!1}};function E(e){let t="";return e.forEach(n=>{t+=n.isOverwritable?".":n.letter}),new RegExp("(\\b|^)"+t+"(\\b|$)")}})();
