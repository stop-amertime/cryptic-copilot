"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.decorateGetDefinition = void 0;
const utils_1 = require("../utils");
function decorateGetDefinition(ls, snapshotManager, logger) {
    const getDefinitionAndBoundSpan = ls.getDefinitionAndBoundSpan;
    ls.getDefinitionAndBoundSpan = (fileName, position) => {
        const definition = getDefinitionAndBoundSpan(fileName, position);
        if (!(definition === null || definition === void 0 ? void 0 : definition.definitions)) {
            return definition;
        }
        return {
            ...definition,
            definitions: definition.definitions
                .map((def) => {
                var _a;
                if (!(0, utils_1.isSvelteFilePath)(def.fileName)) {
                    return def;
                }
                let textSpan = (_a = snapshotManager
                    .get(def.fileName)) === null || _a === void 0 ? void 0 : _a.getOriginalTextSpan(def.textSpan);
                if (!textSpan) {
                    // Unmapped positions are for example the default export.
                    // Fall back to the start of the file to at least go to the correct file.
                    textSpan = { start: 0, length: 1 };
                }
                return {
                    ...def,
                    textSpan,
                    // Spare the work for now
                    originalTextSpan: undefined,
                    contextSpan: undefined,
                    originalContextSpan: undefined
                };
            })
                .filter(utils_1.isNotNullOrUndefined)
        };
    };
}
exports.decorateGetDefinition = decorateGetDefinition;
//# sourceMappingURL=definition.js.map